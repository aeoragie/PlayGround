<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      throwExceptions="false"
      internalLogLevel="Off">

  <!-- 경로 변수 -->
  <variable name="logDirectory" value="${basedir}/Logs" />
  <variable name="archiveDirectory" value="${basedir}/Logs/Archive" />

  <!-- 레이아웃: 파일용 (상세) -->
  <variable name="fileLayout"
    value="${longdate}[${level:uppercase=true}][${threadid:padCharacter=0}] ${message}${onexception:inner=${newline}${exception:format=tostring}}" />

  <!-- 레이아웃: 콘솔용 -->
  <variable name="consoleLayout"
    value="${longdate}[${level:uppercase=true}][${threadid:padCharacter=0}] ${message}${onexception:inner=${newline}${exception:format=tostring}}" />

  <targets>
    <!-- 메인 로그 파일 (일별 + 100MB 롤링) -->
    <target xsi:type="File"
            name="FileLogger"
            fileName="${logDirectory}/${processname}.log"
            layout="${fileLayout}"
            archiveFileName="${archiveDirectory}/${processname}.{#####}.log"
            archiveEvery="Day"
            archiveAboveSize="104857600"
            archiveNumbering="DateAndSequence"
            archiveDateFormat="yyyyMMdd"
            maxArchiveFiles="30"
            maxArchiveDays="30"
            concurrentWrites="true"
            keepFileOpen="true"
            encoding="utf-8" />

    <!-- 콘솔 출력 (레벨별 색상) -->
    <target xsi:type="ColoredConsole" name="ConsoleLogger" layout="${consoleLayout}">
      <highlight-word text="[TRACE]" foregroundColor="DarkGray" />
      <highlight-word text="[DEBUG]" foregroundColor="Gray" />
      <highlight-word text="[INFO]" foregroundColor="Green" />
      <highlight-word text="[WARN]" foregroundColor="Yellow" />
      <highlight-word text="[ERROR]" foregroundColor="Red" />
      <highlight-word text="[FATAL]" foregroundColor="White" backgroundColor="DarkRed" />
    </target>
  </targets>

  <rules>
    <!-- Microsoft 프레임워크 로그 필터링 -->
    <logger name="Microsoft.Hosting.Lifetime" minlevel="Info" writeTo="ConsoleLogger" final="true" />
    <logger name="Microsoft.AspNetCore.Hosting.*" minlevel="Warning" writeTo="FileLogger" final="true" />
    <logger name="Microsoft.EntityFrameworkCore.*" minlevel="Warning" writeTo="FileLogger" final="true" />
    <logger name="Microsoft.*" maxlevel="Info" final="true" />

    <!-- System.Net.Http 필터링 -->
    <logger name="System.Net.Http.*" maxlevel="Info" final="true" />

    <!-- 기본 규칙: Debug 이상 → 파일 + 콘솔 -->
    <logger name="*" minlevel="Debug" writeTo="FileLogger,ConsoleLogger" />
  </rules>

</nlog>
