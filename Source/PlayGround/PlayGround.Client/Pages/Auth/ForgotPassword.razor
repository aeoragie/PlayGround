@page "/auth/forgot-password"
@layout MainLayout
@inject Services.AuthService AuthService
@inject NavigationManager Navigation

<PageTitle>비밀번호 찾기 — PlayGround</PageTitle>

<AuthLayout Variant="AuthLayout.AuthVariant.LoginRegister">

    @* 헤더 *@
    <div class="mb-6">
        <h1 class="text-xl font-bold text-navy mb-1">비밀번호 찾기</h1>
        <p class="text-[13px] text-text-secondary">가입한 이메일을 입력하면 비밀번호 재설정 링크를 보내드립니다.</p>
    </div>

    @* 에러 메시지 *@
    @if (!string.IsNullOrEmpty(mErrorMessage))
    {
        <div class="px-3.5 py-2.5 rounded-btn text-xs font-semibold mb-4
                    bg-red-50 text-red-600 border border-red-200">
            @mErrorMessage
        </div>
    }

    @* 성공 메시지 *@
    @if (mSent)
    {
        <div class="px-3.5 py-2.5 rounded-btn text-xs font-semibold mb-4
                    bg-green-50 text-green-600 border border-green-200">
            이메일이 발송되었습니다. 메일함을 확인해주세요.
        </div>
    }

    @* 이메일 입력 *@
    <div class="mb-3.5">
        <label class="block text-xs font-semibold text-slate mb-1.5">이메일</label>
        <input type="email" class="auth-input" placeholder="email@example.com"
               @bind="mEmail" @bind:event="oninput" />
    </div>

    @* 제출 *@
    <button class="btn-auth-submit" @onclick="HandleSubmit" disabled="@mIsLoading">
        @(mIsLoading ? "발송 중..." : "재설정 링크 받기")
    </button>

    @* 로그인 돌아가기 *@
    <div class="text-center mt-[18px] text-[13px] text-text-secondary">
        <a href="/auth/login" class="text-navy font-bold no-underline hover:text-primary">&larr; 로그인으로 돌아가기</a>
    </div>

</AuthLayout>

@code {
    private string mEmail = string.Empty;
    private bool mIsLoading;
    private bool mSent;
    private string? mErrorMessage;

    private async Task HandleSubmit()
    {
        mErrorMessage = null;

        if (string.IsNullOrWhiteSpace(mEmail))
        {
            mErrorMessage = "이메일을 입력해주세요.";
            return;
        }

        mIsLoading = true;

        try
        {
            var result = await AuthService.ForgotPasswordAsync(mEmail);

            if (result.IsSuccess)
            {
                mSent = true;
            }
            else
            {
                mErrorMessage = result.Error ?? "요청에 실패했습니다.";
            }
        }
        catch
        {
            mErrorMessage = "서버와 통신할 수 없습니다.";
        }
        finally
        {
            mIsLoading = false;
        }
    }
}
